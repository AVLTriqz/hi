-- Karker Hub Mobile ‚Äî FINAL EDITION (One LocalScript)
-- Put in StarterPlayerScripts or StarterGui (LocalScript)
-- All features included. Mobile-friendly entire-hub dragging.

-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local Debris = game:GetService("Debris")
local TeleportService = game:GetService("TeleportService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- Config
local CONF = {
    accent = Color3.fromRGB(255, 80, 60),
    bg = Color3.fromRGB(6,6,8),
    floatStrength = 0.55,
    auraRadius = 14,
    rainbowSpeed = 1.2,
    fireAuraDuration = 15,
    -- Roblox sound IDs
    sounds = {
        click = "rbxassetid://2101148",
        hover = "rbxassetid://146069018",
        notif = "rbxassetid://138186576",
        vine = "rbxassetid://4590662766",
        bruh = "rbxassetid://4275849483",
        oof = "rbxassetid://131072121",
        boss = "rbxassetid://184614231"
    }
}

-- Local state
local STATE = {
    destroyed = false,
    parts = {},              -- created world parts
    gui = nil,
    notifGui = nil,
    notifHolder = nil,
    playerHighlights = {},   -- player -> highlight
    itemHighlights = {},     -- item -> highlight
    float = { enabled=false, att=nil, vf=nil, strength = CONF.floatStrength },
    special = { active=false, auraPart=nil, scanner=nil, radius = CONF.auraRadius },
    conns = {}
}

-- Utilities
local function safeChar() return player.Character or player.CharacterAdded:Wait() end

local function playSound(id, parent, vol, loop)
    if not id then return end
    local s = Instance.new("Sound")
    s.SoundId = id
    s.Volume = vol or 1
    s.Looped = (loop == true)
    s.Parent = parent or playerGui
    pcall(function() s:Play() end)
    if not s.Looped then Debris:AddItem(s, 6) end
    return s
end

local function tween(obj, t, props, style, dir)
    local info = TweenInfo.new(t, style or Enum.EasingStyle.Quad, dir or Enum.EasingDirection.Out)
    local T = TweenService:Create(obj, info, props)
    T:Play()
    return T
end

local function newUICorner(parent, r) local c = Instance.new("UICorner"); c.CornerRadius = UDim.new(0, r or 10); c.Parent = parent; return c end
local function newStroke(parent, col, thick) local s = Instance.new("UIStroke", parent); s.Color = col or Color3.fromRGB(30,30,30); s.Thickness = thick or 1; return s end

-- Custom Notifications (bottom-left)
local function createNotifSystem()
    local g = Instance.new("ScreenGui", playerGui)
    g.Name = "KH_Notifs"
    g.ResetOnSpawn = false

    local holder = Instance.new("Frame", g)
    holder.Name = "Holder"
    holder.AnchorPoint = Vector2.new(0,1)
    holder.Position = UDim2.new(0, 12, 1, -12)
    holder.Size = UDim2.new(0, 360, 0, 420)
    holder.BackgroundTransparency = 1

    local layout = Instance.new("UIListLayout", holder)
    layout.SortOrder = Enum.SortOrder.LayoutOrder
    layout.Padding = UDim.new(0, 8)

    return g, holder
end

STATE.notifGui, STATE.notifHolder = createNotifSystem()

local function notify(title, text, duration)
    if STATE.destroyed then return end
    duration = duration or 3
    local f = Instance.new("Frame", STATE.notifHolder)
    f.Size = UDim2.new(1,0,0,0)
    f.BackgroundColor3 = Color3.fromRGB(12,12,14)
    newUICorner(f, 10)
    newStroke(f, CONF.accent, 1)

    local icon = Instance.new("TextLabel", f)
    icon.Size = UDim2.new(0,40,0,40); icon.Position = UDim2.new(0,8,0,8)
    icon.BackgroundTransparency = 1; icon.Font = Enum.Font.Cartoon; icon.TextSize = 20; icon.Text = "üîî"; icon.TextColor3 = CONF.accent

    local tLabel = Instance.new("TextLabel", f)
    tLabel.Size = UDim2.new(1, -56, 0, 20); tLabel.Position = UDim2.new(0,56,0,6)
    tLabel.BackgroundTransparency = 1; tLabel.Font = Enum.Font.Cartoon; tLabel.TextSize = 14; tLabel.TextColor3 = CONF.accent
    tLabel.Text = title

    local mLabel = Instance.new("TextLabel", f)
    mLabel.Size = UDim2.new(1, -56, 0, 44); mLabel.Position = UDim2.new(0,56,0,26)
    mLabel.BackgroundTransparency = 1; mLabel.Font = Enum.Font.Cartoon; mLabel.TextSize = 13; mLabel.TextColor3 = Color3.fromRGB(220,220,220)
    mLabel.TextWrapped = true; mLabel.TextXAlignment = Enum.TextXAlignment.Left
    mLabel.Text = text

    playSound(CONF.sounds.notif, f, 1, false)
    tween(f, 0.26, {Size = UDim2.new(1,0,0,92)})
    task.delay(duration, function()
        if f and f.Parent then
            tween(f, 0.18, {Size = UDim2.new(1,0,0,0)})
            task.wait(0.22)
            if f and f.Parent then f:Destroy() end
        end
    end)
end

-- Loading screen (full cover)
local function spawnLoading(onFinish)
    local gui = Instance.new("ScreenGui", playerGui)
    gui.Name = "KH_Loading"
    gui.ResetOnSpawn = false
    gui.IgnoreGuiInset = true

    local bg = Instance.new("Frame", gui)
    bg.Size = UDim2.new(1,0,1,0); bg.Position = UDim2.new(0,0,0,0); bg.BackgroundColor3 = CONF.bg; bg.BorderSizePixel = 0

    local vign = Instance.new("ImageLabel", bg)
    vign.Size = UDim2.new(1.6,0,1.6,0); vign.Position = UDim2.new(-0.3,0,-0.3,0); vign.BackgroundTransparency = 1
    vign.Image = "rbxassetid://5058094581"; vign.ImageTransparency = 0.6

    local title = Instance.new("TextLabel", bg)
    title.Size = UDim2.new(0.9,0,0,88); title.Position = UDim2.new(0.05,0,0.12,0)
    title.BackgroundTransparency = 1; title.Font = Enum.Font.Cartoon; title.TextSize = 28; title.TextColor3 = Color3.fromRGB(250,250,250)
    title.Text = "Karker Hub Mobile"

    local center = Instance.new("TextLabel", bg)
    center.Size = UDim2.new(0.86,0,0,120); center.Position = UDim2.new(0.07,0,0.42,0)
    center.BackgroundTransparency = 1; center.Font = Enum.Font.Cartoon; center.TextSize = 16; center.TextWrapped = true

    local barBg = Instance.new("Frame", bg)
    barBg.Size = UDim2.new(0.56,0,0,14); barBg.Position = UDim2.new(0.22,0,0.72,0)
    barBg.BackgroundColor3 = Color3.fromRGB(18,18,20); newUICorner(barBg, 8); newStroke(barBg, Color3.fromRGB(40,40,44), 1)

    local barFill = Instance.new("Frame", barBg)
    barFill.Size = UDim2.new(0,0,1,0); barFill.BackgroundColor3 = CONF.accent; newUICorner(barFill, 8)

    -- snow frames
    local snowFolder = Instance.new("Folder", bg)
    snowFolder.Name = "Snow"
    task.spawn(function()
        while bg.Parent do
            local s = Instance.new("Frame", snowFolder)
            s.Size = UDim2.new(0, math.random(3,7), 0, math.random(3,7))
            s.Position = UDim2.new(math.random(), 0, -0.1, 0)
            s.BackgroundColor3 = Color3.fromRGB(255,255,255); s.BackgroundTransparency = 0.22; s.BorderSizePixel = 0
            local x = math.random(-160,160)
            tween(s, math.random(4,8), {Position = UDim2.new(s.Position.X.Scale, x, 1.12, 0), BackgroundTransparency = 1})
            Debris:AddItem(s, 6)
            task.wait(0.07)
        end
    end)

    local jokes = {
        "‚ú® installing drip modules...",
        "üçï bribing devs with pizza... almost done",
        "ü§ñ patching 'stealthy swagger' (pls don't report)",
        "üíÄ searching for lost Brainrots... beep boop",
        "üéâ applying snow, chaos and silly sounds"
    }
    local msg = jokes[math.random(1,#jokes)]
    playSound(CONF.sounds.vine, bg, 0.85, false)

    -- typewriter
    spawn(function()
        for i = 1, #msg do
            center.Text = msg:sub(1, i)
            task.wait(0.03)
        end
    end)

    -- progress animation
    spawn(function()
        local prog = 0
        local steps = {0.12,0.28,0.48,0.72,0.9,1}
        for _, s in ipairs(steps) do
            while prog < s do
                prog = math.min(s, prog + (0.01 + math.random()*0.03))
                tween(barFill, 0.12, {Size = UDim2.new(prog, 0, 1, 0)})
                task.wait(0.06)
            end
            task.wait(0.16 + math.random()*0.5)
        end
        task.wait(0.6)
        tween(bg, 0.9, {BackgroundTransparency = 1})
        tween(center, 0.9, {TextTransparency = 1})
        tween(barBg, 0.6, {BackgroundTransparency = 1})
        task.wait(0.9)
        if snowFolder and snowFolder.Parent then snowFolder:Destroy() end
        gui:Destroy()
        if type(onFinish) == "function" then pcall(onFinish) end
    end)
end

-- world ring factory
local function createRing(radius, color)
    local p = Instance.new("Part", workspace)
    p.Anchored = true; p.CanCollide = false
    p.Size = Vector3.new(radius*2, 0.25, radius*2)
    p.Material = Enum.Material.Neon; p.Color = color or CONF.accent
    p.Transparency = 0.32; p.Shape = Enum.PartType.Cylinder; p.Orientation = Vector3.new(90,0,0)
    p.Name = "KH_AuraRing"
    table.insert(STATE.parts, p)
    return p
end

-- Brainrot name match helpers
local brainrotNames = {"Brainrot","Tralelero","Saturnita","Balerina Capucina","Coco Fanto Ele Fanto","orcalero Orcala","odin din dun","Dragons"}
local function isBrainrotName(name)
    if not name then return false end
    local n = tostring(name):lower()
    for _, s in ipairs(brainrotNames) do
        if string.find(n, s:lower()) then return true end
    end
    return false
end

-- Build hub (UI + features)
local function buildHub()
    if STATE.destroyed then return end

    local gui = Instance.new("ScreenGui", playerGui)
    gui.Name = "KarkerHubMobile"
    gui.ResetOnSpawn = false
    STATE.gui = gui

    local window = Instance.new("Frame", gui)
    window.Name = "Window"
    window.Size = UDim2.new(0, 320, 0, 240)
    window.Position = UDim2.new(0.5, -160, 0.5, -120)
    window.AnchorPoint = Vector2.new(0.5, 0.5)
    window.BackgroundColor3 = Color3.fromRGB(4,4,6)
    window.BorderSizePixel = 0
    newUICorner(window, 14); newStroke(window, Color3.fromRGB(18,18,20), 1)

    -- rainbow stroke
    local stroke = Instance.new("UIStroke", window)
    stroke.Thickness = 3; stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    local hue = 0
    STATE.conns.rainbow = RunService.RenderStepped:Connect(function(dt)
        hue = (hue + dt * (1/CONF.rainbowSpeed)) % 1
        stroke.Color = Color3.fromHSV(hue, 0.95, 1)
    end)

    -- little fire particle under hub
    local auraHolder = Instance.new("Frame", window)
    auraHolder.Size = UDim2.new(1,0,0,6); auraHolder.Position = UDim2.new(0,0,1,-6); auraHolder.BackgroundTransparency = 1
    local auraEmitter = Instance.new("ParticleEmitter", auraHolder)
    auraEmitter.Texture = "rbxassetid://241594408"
    auraEmitter.Rate = 18; auraEmitter.Lifetime = NumberRange.new(0.6,1.0); auraEmitter.Speed = NumberRange.new(0.1,0.3)
    auraEmitter.Enabled = true

    -- background snow frames (UI)
    local bgSnow = Instance.new("Folder", window); bgSnow.Name = "BG_Snow"
    task.spawn(function()
        while window and window.Parent do
            local s = Instance.new("Frame", bgSnow)
            s.Size = UDim2.new(0, math.random(2,6), 0, math.random(2,6))
            s.Position = UDim2.new(math.random(), 0, -0.12, 0)
            s.BackgroundColor3 = Color3.fromRGB(255,255,255); s.BackgroundTransparency = 0.86; s.BorderSizePixel = 0
            local x = math.random(-120,120)
            tween(s, math.random(6,10), {Position = UDim2.new(s.Position.X.Scale, x, 1.12, 0)})
            Debris:AddItem(s, 10)
            task.wait(0.14)
        end
    end)

    -- header (we will make entire window draggable so clicks anywhere start drag)
    local header = Instance.new("Frame", window)
    header.Size = UDim2.new(1,0,0,56); header.Position = UDim2.new(0,0,0,0)
    header.BackgroundColor3 = Color3.fromRGB(10,10,12); newUICorner(header, 12)

    local title = Instance.new("TextLabel", header)
    title.Size = UDim2.new(0.7,0,1,0); title.Position = UDim2.new(0.04,0,0,0)
    title.BackgroundTransparency = 1; title.Font = Enum.Font.Cartoon; title.TextSize = 18; title.TextColor3 = Color3.fromRGB(245,245,245)
    title.Text = "Karker Hub üî•"

    local subtitle = Instance.new("TextLabel", header)
    subtitle.Size = UDim2.new(0.66,0,0,14); subtitle.Position = UDim2.new(0.04,0,1,-20)
    subtitle.BackgroundTransparency = 1; subtitle.Font = Enum.Font.Cartoon; subtitle.TextSize = 10; subtitle.TextColor3 = Color3.fromRGB(200,200,200)
    subtitle.Text = "Mobile ‚Äî Created by YOUNG"

    -- header buttons
    local function mkBtn(parent, txt, xOff, bgc)
        local b = Instance.new("TextButton", parent)
        b.Size = UDim2.new(0,36,0,28); b.Position = UDim2.new(1, xOff, 0.12, 0)
        b.Text = txt; b.Font = Enum.Font.Cartoon; b.TextSize = 18; b.BackgroundColor3 = bgc or Color3.fromRGB(28,28,30)
        newUICorner(b, 8)
        return b
    end
    local btnMin = mkBtn(header, "‚Äî", -150)
    local btnToggle = mkBtn(header, "‚ü≥", -104)
    local btnDestroy = mkBtn(header, "X", -58, Color3.fromRGB(140,36,36))

    -- Entire-window mobile+pc drag (robust)
    do
        local dragging = false
        local dragInput = nil
        local dragStart = nil
        local startPos = nil

        local function beginDrag(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
                dragging = true
                dragInput = input
                dragStart = input.Position
                startPos = window.Position
                input.Changed:Connect(function()
                    if input.UserInputState == Enum.UserInputState.End then
                        dragging = false
                    end
                end)
            end
        end

        local function updateDrag(input)
            if not dragging then return end
            if input ~= dragInput then return end
            local delta = input.Position - dragStart
            local newX = startPos.X.Offset + delta.X
            local newY = startPos.Y.Offset + delta.Y
            local viewSize = workspace.CurrentCamera and workspace.CurrentCamera.ViewportSize or Vector2.new(1280,720)
            local wsize = window.AbsoluteSize
            newX = math.clamp(newX, -wsize.X*0.8, viewSize.X - 40)
            newY = math.clamp(newY, -wsize.Y*0.8, viewSize.Y - 40)
            window.Position = UDim2.new(0, newX, 0, newY)
        end

        window.InputBegan:Connect(beginDrag)
        UserInputService.InputChanged:Connect(updateDrag)
    end

    -- content area
    local content = Instance.new("Frame", window)
    content.Size = UDim2.new(1, -28, 1, -86); content.Position = UDim2.new(0, 14, 0, 66); content.BackgroundTransparency = 1

    local leftScroll = Instance.new("ScrollingFrame", content)
    leftScroll.Size = UDim2.new(1, 0, 1, 0)
    leftScroll.CanvasSize = UDim2.new(0, 0, 0, 1400)
    leftScroll.ScrollBarThickness = 8
    leftScroll.BackgroundTransparency = 1
    local leftLayout = Instance.new("UIListLayout", leftScroll)
    leftLayout.Padding = UDim.new(0, 10)
    leftLayout.SortOrder = Enum.SortOrder.LayoutOrder

    local infoBox = Instance.new("TextLabel", window)
    infoBox.Size = UDim2.new(0.5, -8, 0, 28)
    infoBox.Position = UDim2.new(0.5, -8, 1, -38)
    infoBox.BackgroundTransparency = 1; infoBox.Font = Enum.Font.Cartoon; infoBox.TextSize = 12; infoBox.TextColor3 = Color3.fromRGB(200,200,200)
    infoBox.Text = ("Welcome %s ‚Äî YOUNG"):format(player.Name)

    -- Button factory
    local function makeButton(label, emoji)
        local b = Instance.new("TextButton")
        b.Size = UDim2.new(1, -16, 0, 52)
        b.BackgroundColor3 = Color3.fromRGB(12,12,14)
        newUICorner(b, 10)
        newStroke(b, Color3.fromRGB(24,24,26), 1)
        b.Font = Enum.Font.Cartoon
        b.TextSize = 15
        b.TextColor3 = Color3.fromRGB(230,230,230)
        b.AutoButtonColor = false
        b.Text = ((emoji and (emoji .. "  ") or "") .. label)
        b.MouseEnter:Connect(function() playSound(CONF.sounds.hover, b, 0.5, false); tween(b, 0.12, {BackgroundColor3 = Color3.fromRGB(28,6,6)}); tween(b, 0.12, {Size = UDim2.new(1, -12, 0, 56)}) end)
        b.MouseLeave:Connect(function() tween(b, 0.12, {BackgroundColor3 = Color3.fromRGB(12,12,14)}); tween(b, 0.12, {Size = UDim2.new(1, -16, 0, 52)}) end)
        b.Parent = leftScroll
        return b
    end

    -- Feature implementations

    -- PLAYER ESP
    local function togglePlayerESP()
        if STATE.playerESPEnabled then
            for _, h in pairs(STATE.playerHighlights) do pcall(function() h:Destroy() end) end
            STATE.playerHighlights = {}
            STATE.playerESPEnabled = false
            notify("ESP", "Player ESP disabled", 2)
            return
        end
        STATE.playerESPEnabled = true
        for _, pl in pairs(Players:GetPlayers()) do
            if pl ~= player and pl.Character then
                local highlight = Instance.new("Highlight", pl.Character)
                highlight.Name = "KH_PlayerHighlight"
                highlight.FillColor = Color3.fromRGB(255,150,150)
                highlight.OutlineColor = Color3.fromRGB(255,80,80)
                STATE.playerHighlights[pl] = highlight
            end
        end
        if not STATE.conns.playerAdded then
            STATE.conns.playerAdded = Players.PlayerAdded:Connect(function(pl)
                if STATE.playerESPEnabled and pl ~= player then
                    pl.CharacterAdded:Wait()
                    if pl.Character then
                        local highlight = Instance.new("Highlight", pl.Character)
                        highlight.FillColor = Color3.fromRGB(255,150,150); highlight.OutlineColor = Color3.fromRGB(255,80,80)
                        STATE.playerHighlights[pl] = highlight
                    end
                end
            end)
        end
        notify("ESP", "Player ESP enabled (local)", 2)
    end

    -- BRAINROT ESP
    local function toggleBrainrotESP()
        if STATE.brESP then
            for obj,h in pairs(STATE.itemHighlights) do pcall(function() if h and h.Parent then h:Destroy() end end) end
            STATE.itemHighlights = {}
            STATE.brESP = false
            notify("Brainrot ESP", "Disabled", 2)
            return
        end
        STATE.brESP = true
        for _, obj in ipairs(workspace:GetDescendants()) do
            if obj:IsA("BasePart") or obj:IsA("Model") then
                if isBrainrotName(obj.Name) then
                    local h = Instance.new("Highlight")
                    h.Name = "KH_ItemHighlight"
                    h.FillColor = Color3.fromRGB(0,125,255)
                    h.OutlineColor = Color3.fromRGB(255,30,30)
                    h.Parent = obj
                    STATE.itemHighlights[obj] = h
                end
            end
        end
        notify("Brainrot ESP", "Enabled (local)", 2)
    end

    -- FLOAT (VectorForce)
    local function toggleFloat()
        if not STATE.float.enabled then
            local char = player.Character or player.CharacterAdded:Wait()
            local hrp = char:FindFirstChild("HumanoidRootPart")
            if not hrp then notify("Float", "Character not ready", 2); return end
            if STATE.float.att then pcall(function() STATE.float.att:Destroy() end) end
            if STATE.float.vf then pcall(function() STATE.float.vf:Destroy() end) end
            local att = Instance.new("Attachment", hrp); att.Name = "KH_FloatAttach"
            local vf = Instance.new("VectorForce", hrp); vf.Attachment0 = att; vf.RelativeTo = Enum.ActuatorRelativeTo.World
            local mass = hrp:GetMass()
            vf.Force = Vector3.new(0, mass * workspace.Gravity * STATE.float.strength, 0)
            STATE.float.att = att; STATE.float.vf = vf; STATE.float.enabled = true
            notify("Float", "Float enabled ‚Äî glide mode üïäÔ∏è", 2)
        else
            if STATE.float.vf then pcall(function() STATE.float.vf:Destroy() end) end
            if STATE.float.att then pcall(function() STATE.float.att:Destroy() end) end
            STATE.float.att = nil; STATE.float.vf = nil; STATE.float.enabled = false
            notify("Float", "Float disabled", 2)
        end
    end

    -- TELEPORT BY TAP
    local teleportConn = nil
    local function startTeleportTap()
        notify("Teleport", "Tap/click anywhere to teleport", 3)
        if teleportConn then pcall(function() teleportConn:Disconnect() end) end
        teleportConn = UserInputService.InputBegan:Connect(function(input, processed)
            if processed then return end
            if input.UserInputType == Enum.UserInputType.Touch or input.UserInputType == Enum.UserInputType.MouseButton1 then
                local m = player:GetMouse()
                if m and m.Hit then
                    local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
                    if hrp then
                        hrp.CFrame = CFrame.new(m.Hit.Position + Vector3.new(0, 3, 0))
                        notify("Teleport", "Teleported to target", 2)
                    end
                end
                if teleportConn then pcall(function() teleportConn:Disconnect() end) end
                teleportConn = nil
            end
        end)
    end

    -- FIRE AURA (15s)
    local function spawnFireAuraOnPlayer()
        local char = player.Character
        if not char or not char:FindFirstChild("HumanoidRootPart") then notify("Fire", "Character not ready", 2); return end
        local hrp = char.HumanoidRootPart
        local p = Instance.new("Part", workspace)
        p.Transparency = 1; p.Anchored = true; p.CanCollide = false
        p.Position = hrp.Position
        local emitter = Instance.new("ParticleEmitter", p)
        emitter.Texture = "rbxassetid://241594408"
        emitter.Rate = 140
        emitter.Lifetime = NumberRange.new(0.8, 1.6)
        emitter.Speed = NumberRange.new(0.2, 0.6)
        Debris:AddItem(p, CONF.fireAuraDuration + 1)
        local conn
        conn = RunService.Heartbeat:Connect(function()
            if not p or not p.Parent or not hrp or not hrp.Parent then
                if conn then conn:Disconnect() end
                return
            end
            p.Position = hrp.Position - Vector3.new(0,1,0)
        end)
        task.delay(CONF.fireAuraDuration, function()
            if conn then pcall(function() conn:Disconnect() end) end
            if p and p.Parent then emitter.Rate = 0; task.delay(1.2, function() if p and p.Parent then p:Destroy() end end) end
        end)
        notify("Fire Aura", ("Spawned for %ds üî•"):format(CONF.fireAuraDuration), 3)
    end

    -- SPECIAL SAUCE (aura + local taser visuals)
    local function toggleSpecialSauce()
        if STATE.special.active then
            STATE.special.active = false
            if STATE.special.scanner then pcall(function() STATE.special.scanner:Disconnect() end) end
            if STATE.special.auraPart and STATE.special.auraPart.Parent then STATE.special.auraPart:Destroy() end
            notify("Special Sauce", "Deactivated", 2)
            return
        end

        local char = safeChar()
        local hrp = char:FindFirstChild("HumanoidRootPart")
        if not hrp then notify("Special Sauce", "Character not ready", 2); return end

        notify("Special Sauce", "huh I see u tryna steal lol üòà", 3)
        playSound(CONF.sounds.bruh, playerGui, 0.9, false)
        task.wait(2)

        local ring = createRing(STATE.special.radius, CONF.accent)
        ring.Position = hrp.Position - Vector3.new(0, 3, 0)
        ring.Parent = workspace
        STATE.special.auraPart = ring

        local flame = Instance.new("ParticleEmitter", hrp)
        flame.Texture = "rbxassetid://241594408"; flame.Rate = 90; flame.Lifetime = NumberRange.new(0.9,1.6); flame.Size = NumberSequence.new(1.1)
        Debris:AddItem(flame, 12)

        STATE.special.active = true

        STATE.special.scanner = RunService.Heartbeat:Connect(function()
            if not STATE.special.active then return end
            if not (ring and ring.Parent and hrp and hrp.Parent) then return end
            ring.Position = hrp.Position - Vector3.new(0, 3, 0)
            for _, pl in ipairs(Players:GetPlayers()) do
                if pl ~= player and pl.Character and pl.Character:FindFirstChild("HumanoidRootPart") then
                    local oth = pl.Character.HumanoidRootPart
                    local dist = (oth.Position - hrp.Position).Magnitude
                    if dist <= STATE.special.radius then
                        local mag = dist
                        local bolt = Instance.new("Part", workspace)
                        bolt.Anchored = true; bolt.CanCollide = false; bolt.Material = Enum.Material.Neon
                        bolt.Color = Color3.fromRGB(120,210,255); bolt.Size = Vector3.new(0.18,0.18,mag)
                        bolt.CFrame = CFrame.new(hrp.Position, oth.Position) * CFrame.new(0,0,-mag/2) * CFrame.Angles(math.pi/2,0,0)
                        Debris:AddItem(bolt, 0.26)

                        local spark = Instance.new("ParticleEmitter", oth)
                        spark.Texture = "rbxassetid://256249139"; spark.Rate = 0; spark:Emit(30)
                        Debris:AddItem(spark, 0.6)

                        notify("TASER", pl.Name .. " triggered the aura (local) ‚ö°", 2)

                        local hum = pl.Character:FindFirstChildOfClass("Humanoid")
                        if hum then
                            local prevWS = hum.WalkSpeed; local prevJP = hum.JumpPower or 50
                            pcall(function() hum.WalkSpeed = 0; hum.JumpPower = 0 end)
                            task.delay(2.6, function() pcall(function() if hum then hum.WalkSpeed = prevWS or 16; hum.JumpPower = prevJP end end) end)
                        end
                    end
                end
            end
        end)
    end

    -- FINAL BOSS MODE (overlay + camera shake + fire rain + boss music)
    local function doFinalBoss()
        notify("FINAL BOSS", "Final Boss Mode activated ‚Äî chaos incoming üíÄ", 4)
        playSound(CONF.sounds.boss, playerGui, 1.2, false)

        local overlayGui = Instance.new("ScreenGui", playerGui); overlayGui.Name = "KH_BossOverlay"
        local f = Instance.new("Frame", overlayGui)
        f.Size = UDim2.new(1,0,1,0); f.BackgroundColor3 = Color3.fromRGB(255, 20, 20); f.BackgroundTransparency = 1; f.ZIndex = 9999
        tween(f, 0.35, {BackgroundTransparency = 0.45}, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)

        local cam = workspace.CurrentCamera
        spawn(function()
            for i=1,36 do
                if cam and cam.CFrame then cam.CFrame = cam.CFrame * CFrame.new((math.random()-0.5)*0.8, (math.random()-0.5)*0.8, 0) end
                task.wait(0.04)
            end
        end)

        local folder = Instance.new("Folder", workspace); folder.Name = "KH_BossRain"
        for i=1,36 do
            local p = Instance.new("Part", folder)
            p.Size = Vector3.new(0.6,0.6,0.6); p.Anchored = false; p.CanCollide = false; p.Material = Enum.Material.Neon
            p.Color = Color3.fromRGB(255,120,60)
            local basePos = (player.Character and player.Character:FindFirstChild("HumanoidRootPart") and player.Character.HumanoidRootPart.Position) or workspace.CurrentCamera.CFrame.p
            p.Position = basePos + Vector3.new(math.random(-30,30), 60 + math.random(0,40), math.random(-30,30))
            p.Velocity = Vector3.new(0, -60, 0)
            Debris:AddItem(p, 6)
        end

        task.delay(14, function()
            if overlayGui and overlayGui.Parent then overlayGui:Destroy() end
            if folder and folder.Parent then folder:Destroy() end
        end)
    end

    -- Server hop
    local function doServerHop()
        notify("Server Hop", "Attempting server hop...", 3)
        pcall(function() TeleportService:Teleport(game.PlaceId, player) end)
    end

    -- Teleport to place/instance
    local function tpToPlace(pid)
        local id = tonumber(pid)
        if not id then notify("Teleport", "Invalid place id", 3); return end
        pcall(function() TeleportService:Teleport(id, player) end)
    end
    local function tpToInstance(pid, jobId)
        local id = tonumber(pid)
        if not id or not jobId or jobId == "" then notify("Teleport", "PlaceId + JobId required", 3); return end
        pcall(function() TeleportService:TeleportToPlaceInstance(id, tostring(jobId), player) end)
    end

    -- Brainrot actions
    local function playMostValuableBrainrot()
        local best = nil; local bestVal = -math.huge
        for _, obj in ipairs(workspace:GetDescendants()) do
            if isBrainrotName(obj.Name) then
                if obj:FindFirstChild("Value") and typeof(obj.Value.Value) == "number" then
                    local v = obj.Value.Value
                    if v > bestVal then bestVal = v; best = obj end
                end
            end
        end
        if best and player.Character then
            pcall(function() best.Parent = player.Character end)
            local base = workspace:FindFirstChild("Base")
            if base and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                if base:IsA("BasePart") then player.Character.HumanoidRootPart.CFrame = base.CFrame
                elseif base:IsA("Model") and base.PrimaryPart then player.Character.HumanoidRootPart.CFrame = base.PrimaryPart.CFrame end
            end
            notify("Brainrot", "Equipped top Brainrot", 3)
        else
            notify("Brainrot", "No Brainrot with numeric Value found", 3)
        end
    end

    local function stealBrainrots()
        local count = 0
        for _, obj in ipairs(workspace:GetDescendants()) do
            for _, n in ipairs(brainrotNames) do
                if obj.Name == n then
                    pcall(function() obj.Parent = player.Character end)
                    count = count + 1
                end
            end
        end
        notify("Brainrots", ("Attempted to steal %d items (local)"):format(count), 3)
    end

    local function goBase()
        local base = workspace:FindFirstChild("Base")
        if base and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            if base:IsA("BasePart") then player.Character.HumanoidRootPart.CFrame = base.CFrame
            elseif base:IsA("Model") and base.PrimaryPart then player.Character.HumanoidRootPart.CFrame = base.PrimaryPart.CFrame end
            notify("Base", "Teleported to Base", 3)
        else
            notify("Base", "Base not found", 3)
        end
    end

    -- UI helper to add button
    local function addButton(label, emoji, callback)
        local b = makeButton(label, emoji)
        b.MouseButton1Click:Connect(function()
            playSound(CONF.sounds.click, b, 0.9, false)
            pcall(callback)
        end)
        return b
    end

    -- Create buttons
    addButton("Player ESP Toggle", "üì°", togglePlayerESP)
    addButton("Brainrots ESP Toggle", "üß†", toggleBrainrotESP)
    addButton("Float Toggle", "üïäÔ∏è", toggleFloat)
    addButton("Teleport Anywhere (Tap)", "üìç", startTeleportTap)
    addButton("Fire Aura (15s)", "üî•", spawnFireAuraOnPlayer)
    addButton("Special Sauce (Toggle)", "üõ°Ô∏è", toggleSpecialSauce)
    addButton("Final Boss Mode", "‚öîÔ∏è", doFinalBoss)
    addButton("Server Hop", "üîÄ", doServerHop)

    -- Teleport boxes
    local pidBox = Instance.new("TextBox", leftScroll)
    pidBox.Size = UDim2.new(1, -16, 0, 28); pidBox.PlaceholderText = "Place ID (number)"; pidBox.BackgroundColor3 = Color3.fromRGB(8,8,10); newUICorner(pidBox, 8)
    local jobBox = Instance.new("TextBox", leftScroll)
    jobBox.Size = UDim2.new(1, -16, 0, 28); jobBox.PlaceholderText = "JobId (instance) (optional)"; jobBox.BackgroundColor3 = Color3.fromRGB(8,8,10); newUICorner(jobBox, 8)
    addButton("Teleport to Place", "üõ∞Ô∏è", function() tpToPlace(pidBox.Text) end)
    addButton("Teleport to Instance", "üîó", function() tpToInstance(pidBox.Text, jobBox.Text) end)

    -- Brainrot action buttons
    addButton("Play Most Valuable Brainrot", "üèÜ", playMostValuableBrainrot)
    addButton("Steal Brainrots", "ü§ù", stealBrainrots)
    addButton("Go Base", "üì¶", goBase)

    -- header controls behavior
    btnMin.MouseButton1Click:Connect(function()
        if window.Size.Y.Offset > 48 then
            tween(window, 0.22, {Size = UDim2.new(window.Size.X.Scale, window.Size.X.Offset, 0, 48)})
            leftScroll.Visible = false
            infoBox.Visible = false
        else
            tween(window, 0.22, {Size = UDim2.new(window.Size.X.Scale, window.Size.X.Offset, 0, 240)})
            leftScroll.Visible = true
            infoBox.Visible = true
        end
    end)
    btnToggle.MouseButton1Click:Connect(function() window.Visible = not window.Visible end)
    btnDestroy.MouseButton1Click:Connect(function()
        notify("Karker Hub", "Destroying hub and cleaning up...", 2)
        STATE.destroyed = true
        if STATE.special.scanner then pcall(function() STATE.special.scanner:Disconnect() end) end
        if STATE.conns.rainbow then pcall(function() STATE.conns.rainbow:Disconnect() end) end
        if STATE.conns.playerAdded then pcall(function() STATE.conns.playerAdded:Disconnect() end) end
        for _, p in ipairs(STATE.parts) do pcall(function() if p and p.Parent then p:Destroy() end end) end
        for pl,h in pairs(STATE.playerHighlights) do pcall(function() if h and h.Parent then h:Destroy() end end) end
        for it,h in pairs(STATE.itemHighlights) do pcall(function() if h and h.Parent then h:Destroy() end end) end
        if gui and gui.Parent then gui:Destroy() end
        if STATE.notifGui and STATE.notifGui.Parent then STATE.notifGui:Destroy() end
    end)

    -- respawn handling for float
    Players.LocalPlayer.CharacterAdded:Connect(function(char)
        task.delay(0.5, function()
            if STATE.float.enabled then
                if STATE.float.att then pcall(function() STATE.float.att:Destroy() end) end
                if STATE.float.vf then pcall(function() STATE.float.vf:Destroy() end) end
                local hrp = char:FindFirstChild("HumanoidRootPart")
                if hrp then
                    local att = Instance.new("Attachment", hrp); STATE.float.att = att
                    local vf = Instance.new("VectorForce", hrp); vf.Attachment0 = att; vf.RelativeTo = Enum.ActuatorRelativeTo.World
                    local mass = hrp:GetMass(); vf.Force = Vector3.new(0, mass * workspace.Gravity * STATE.float.strength, 0); STATE.float.vf = vf
                end
            end
        end)
    end)

    -- final housekeeping
    table.insert(STATE.parts, gui)
    notify("Karker Hub", ("Loaded ‚Äî Mobile Final Edition (YOUNG) ‚Äî %s"):format(player.Name), 4)
end

-- Start: spawn loading then build hub
spawnLoading(function()
    if STATE.destroyed then return end
    buildHub()
    playSound(CONF.sounds.vine, playerGui, 0.8, false)
end)

-- Expose manual cleanup
_G.KarkerHubMobileCleanup = function()
    if STATE.destroyed then return end
    STATE.destroyed = true
    for _, p in ipairs(STATE.parts) do pcall(function() if p and p.Parent then p:Destroy() end end) end
    for _, v in pairs(STATE.playerHighlights) do pcall(function() if v and v.Parent then v:Destroy() end end) end
    for _, v in pairs(STATE.itemHighlights) do pcall(function() if v and v.Parent then v:Destroy() end end) end
    if STATE.gui and STATE.gui.Parent then STATE.gui:Destroy() end
    if STATE.notifGui and STATE.notifGui.Parent then STATE.notifGui:Destroy() end
end

-- End of script
